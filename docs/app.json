[{"name": "app.py", "content": "from shiny import render, ui\nfrom shiny.express import input\nimport sqlite3\nimport pandas as pd\nimport ast\nfrom datetime import datetime\nimport io\n\nreturn_table = None\n\n\ndef process_table(process_db):\n    timestamp = process_db\n\n    timestamp = pd.to_datetime(timestamp[\"timestamp\"], unit = \"ms\")\n\n    conv_table = process_db\n    conv_tables = []\n    for i in range(conv_table.shape[0]):\n        data = pd.DataFrame(ast.literal_eval(conv_table[\"targets_ak\"][i])[0], index = [0])\n        conv_tables.append(data)\n\n    conv_tables = pd.concat(conv_tables)\n\n    conv_tables[\"timestamp\"] = timestamp\n\n    return conv_tables\n\nui.panel_title(\"SQLite file reader\")\nui.input_file(\"file1\", \"Choose a .db File\", accept=[\".db\"], multiple=False)\n\n\n@render.text\ndef txt():\n    global return_table\n    if input.file1() is not None:\n        db = sqlite3.connect(input.file1()[0]['datapath'])\n        tables = db.execute('''SELECT name FROM sqlite_master  \n  WHERE type='table';''')\n        tables = tables.fetchall()\n        tables = [table[0] for table in tables if \"test\" in table[0]]\n\n        pd_tables = [pd.read_sql_query(f\"SELECT * from {table}\", db) for table in tables]\n\n        db.close()\n\n        return_table = pd.concat([process_table(table) for table in pd_tables])\n        return \"File Ready, Please click Download\"\n\n@render.download(filename=f\"{datetime.today().strftime('%Y-%m-%d %H:%M:%S')}.csv\")\ndef download():\n    global return_table\n    yield return_table.to_csv()\n", "type": "text"}]